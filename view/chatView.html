<!DOCTYPE html>
<html lang="zh-tw">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>WELCOME TO CHATROOM</title>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script>
		var socket = io();
	</script>
	<style>
		html, body{
			padding:0;
			margin: 0;
		}
		#container {
			top:50px;
			width: 500px;
			margin: 0 auto;
			display: block;
			position: relative;
		}
		#status-box {
			text-align:right;
			font-size: .6em;
		}
		#content {
			width:100%;
			height: 350px;
			border: 1px solid cornflowerblue;
			border-radius: 10px;
			overflow: auto;
		}
		#sendbox {
			width: 100%;
			text-align: center;
		}
		#sendbox input {
			display: inline-block;
		}
		input[name="name"]{
			width: 15%;
		}
		input[name="message"]{
			width: 70%;
		}
		input[type="button"]{
			width:10%;
		}

		.message {
			width: 73%;
			display: inline-block;
			padding: 5px 0 5px 10px;
		}
		.message > span {
			width: 25%;
			display: inline-block;
		}
		.message > span::before {
			color: darkred;
			content: " [ ";
		} 
		.message > span::after {
			color: darkred;
			content: " ]：";
		}
	</style>
</head>
<body>
	<div id="container">
		<div id="status-box">Server: <span id="status">--</span> / <span id="online">0</span> online.
		</div>
	<div id="content">
		<div class="message">
			<span class="name">Minn</span>Hello!
		</div>
		<div class="message">
			<span class="name">Eddie</span>Hi!
		</div>
	</div>
	<br/>
	<div id="sendbox">
		<form id="sendform">
			<input type="text" name="name" id="name" placeholder="暱稱"/>
			<input type="text" name="message" id="message" placeholder="想說什麼?"/>
			<input type="submit" value="送出" />
		</form>
	</div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", ()=>{
			var status = $('#status')[0];
			var online = $('#online')[0];
			var sendForm = $('#sendform')[0];
			
			socket.on("connect", function(){
				status.innerText = "Connected!";
			});
			socket.on("disconnect", function () {
				status.innerText = "Disconnected!";
			});
			socket.on("online", function (amt) {
				online.innerText = amt;
			});

			sendForm.addEventListener("submit", function(element){
				checkSend();
				element.preventDefault();
				var data = {};
				var child = sendForm.children;
				$(child).each(function(index, e){
					if(e.name){
						data[e.name] = e.value;
					}
				});
				socket.emit("send", data);
			});
		});

		function checkSend(){
			var msg = '';
			if(!$('#name').val()){
				msg += 'Please Inter Your Anonymity.\n';
			}

			if(!$('#message').val().trim()){
				msg += 'Please Inter Your Message.';
			}

			if(msg){
				alert(msg);
			}
		}
	</script>
</body>
</html>